import{l as h}from"./utils.DdGZ3POZ.js";const p=h;function S(c,u){const n=c&&c.navigator;if(!n.mediaDevices)return;const l=function(e){if(typeof e!="object"||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(r=>{if(r==="require"||r==="advanced"||r==="mediaSource")return;const o=typeof e[r]=="object"?e[r]:{ideal:e[r]};o.exact!==void 0&&typeof o.exact=="number"&&(o.min=o.max=o.exact);const a=function(i,d){return i?i+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(o.ideal!==void 0){t.optional=t.optional||[];let i={};typeof o.ideal=="number"?(i[a("min",r)]=o.ideal,t.optional.push(i),i={},i[a("max",r)]=o.ideal,t.optional.push(i)):(i[a("",r)]=o.ideal,t.optional.push(i))}o.exact!==void 0&&typeof o.exact!="number"?(t.mandatory=t.mandatory||{},t.mandatory[a("",r)]=o.exact):["min","max"].forEach(i=>{o[i]!==void 0&&(t.mandatory=t.mandatory||{},t.mandatory[a(i,r)]=o[i])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,t){if(u.version>=61)return t(e);if(e=JSON.parse(JSON.stringify(e)),e&&typeof e.audio=="object"){const r=function(o,a,i){a in o&&!(i in o)&&(o[i]=o[a],delete o[a])};e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","googAutoGainControl"),r(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=l(e.audio)}if(e&&typeof e.video=="object"){let r=e.video.facingMode;r=r&&(typeof r=="object"?r:{ideal:r});const o=u.version<66;if(r&&(r.exact==="user"||r.exact==="environment"||r.ideal==="user"||r.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!o)){delete e.video.facingMode;let a;if(r.exact==="environment"||r.ideal==="environment"?a=["back","rear"]:(r.exact==="user"||r.ideal==="user")&&(a=["front"]),a)return n.mediaDevices.enumerateDevices().then(i=>{i=i.filter(f=>f.kind==="videoinput");let d=i.find(f=>a.some(v=>f.label.toLowerCase().includes(v)));return!d&&i.length&&a.includes("back")&&(d=i[i.length-1]),d&&(e.video.deviceId=r.exact?{exact:d.deviceId}:{ideal:d.deviceId}),e.video=l(e.video),p("chrome: "+JSON.stringify(e)),t(e)})}e.video=l(e.video)}return p("chrome: "+JSON.stringify(e)),t(e)},m=function(e){return u.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},g=function(e,t,r){s(e,o=>{n.webkitGetUserMedia(o,t,a=>{r&&r(m(a))})})};if(n.getUserMedia=g.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return s(t,r=>e(r).then(o=>{if(r.audio&&!o.getAudioTracks().length||r.video&&!o.getVideoTracks().length)throw o.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return o},o=>Promise.reject(m(o))))}}}export{S as shimGetUserMedia};
