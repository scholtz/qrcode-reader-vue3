import{g as l,d as v}from"./utils.DdGZ3POZ.js";function h(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(i=>r.call(this,i,t)),t.getVideoTracks().forEach(i=>r.call(this,i,t))},e.RTCPeerConnection.prototype.addTrack=function(t,...i){return i&&i.forEach(n=>{this._localStreams?this._localStreams.includes(n)||this._localStreams.push(n):this._localStreams=[n]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(o);if(t===-1)return;this._localStreams.splice(t,1);const i=o.getTracks();this.getSenders().forEach(n=>{i.includes(n.track)&&this.removeTrack(n)})})}}function C(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const n=new Event("addstream");n.stream=i,this.dispatchEvent(n)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(n=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(n)>=0)return;t._remoteStreams.push(n);const a=new Event("addstream");a.stream=n,t.dispatchEvent(a)})}),r.apply(t,arguments)}}}function T(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.createOffer,t=r.createAnswer,i=r.setLocalDescription,n=r.setRemoteDescription,a=r.addIceCandidate;r.createOffer=function(f,c){const d=arguments.length>=2?arguments[2]:arguments[0],u=o.apply(this,[d]);return c?(u.then(f,c),Promise.resolve()):u},r.createAnswer=function(f,c){const d=arguments.length>=2?arguments[2]:arguments[0],u=t.apply(this,[d]);return c?(u.then(f,c),Promise.resolve()):u};let s=function(m,f,c){const d=i.apply(this,[m]);return c?(d.then(f,c),Promise.resolve()):d};r.setLocalDescription=s,s=function(m,f,c){const d=n.apply(this,[m]);return c?(d.then(f,c),Promise.resolve()):d},r.setRemoteDescription=s,s=function(m,f,c){const d=a.apply(this,[m]);return c?(d.then(f,c),Promise.resolve()):d},r.addIceCandidate=s}function y(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const o=r.mediaDevices,t=o.getUserMedia.bind(o);r.mediaDevices.getUserMedia=i=>t(p(i))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(t,i,n){r.mediaDevices.getUserMedia(t).then(i,n)}).bind(r))}function p(e){return e&&e.video!==void 0?Object.assign({},e,{video:l(e.video)}):e}function S(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(t,i){if(t&&t.iceServers){const n=[];for(let a=0;a<t.iceServers.length;a++){let s=t.iceServers[a];s.urls===void 0&&s.url?(v("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,n.push(s)):n.push(t.iceServers[a])}t.iceServers=n}return new r(t,i)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return r.generateCertificate}})}function R(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio<"u"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof t.offerToReceiveVideo<"u"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):t.offerToReceiveVideo===!0&&!n&&this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function P(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const D=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:P,shimCallbacksAPI:T,shimConstraints:p,shimCreateOfferLegacy:g,shimGetUserMedia:y,shimLocalStreamsAPI:h,shimRTCIceServerUrls:S,shimRemoteStreamsAPI:C,shimTrackEventTransceiver:R},Symbol.toStringTag,{value:"Module"}));export{S as a,g as b,T as c,h as d,C as e,R as f,y as g,P as h,D as s};
