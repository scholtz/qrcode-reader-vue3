import{w as g,f as E,d as Z,a as w,b as ee,c as te,e as re,l as ne}from"./utils.DdGZ3POZ.js";import{shimGetUserMedia as L}from"./getusermedia.D3hymGKc.js";import{shimGetUserMedia as D}from"./getusermedia.D7MBqdid.js";import{s as M,a as se,b as ie,c as ae,d as oe,e as ce,f as pe,g as fe,h as ue}from"./safari_shim.tcOtNX9D.js";function me(t,s){for(var r=0;r<s.length;r++){const e=s[r];if(typeof e!="string"&&!Array.isArray(e)){for(const n in e)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(e,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>e[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function j(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function F(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===n.track.id):i={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[e.stream],this.dispatchEvent(a)}),e.stream.getTracks().forEach(n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===n.id):i={track:n};const a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[e.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)}}else g(t,"track",s=>(s.transceiver||Object.defineProperty(s,"transceiver",{value:{receiver:s.receiver}}),s))}function A(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const s=function(n,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=n.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:n}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,p){let f=n.apply(this,arguments);return f||(f=s(this,o),this._senders.push(f)),f};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){i.apply(this,arguments);const p=this._senders.indexOf(o);p!==-1&&this._senders.splice(p,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(s(this,a))})};const e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],e.apply(this,[i]),i.getTracks().forEach(a=>{const o=this._senders.find(p=>p.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const e=s.apply(this,[]);return e.forEach(n=>n._pc=this),e},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function z(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i});const e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>E(a,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),g(t,"track",e=>(e.receiver._pc=e.srcElement,e)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>E(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const e=arguments[0];let n,i,a;return this.getSenders().forEach(o=>{o.track===e&&(n?a=!0:n=o)}),this.getReceivers().forEach(o=>(o.track===e&&(i?a=!0:i=o),o.track===e)),a||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}function N(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return s.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=s.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(p)===-1&&this._shimmedLocalStreams[o.id].push(p):this._shimmedLocalStreams[o.id]=[o,p],p};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(f=>{if(this.getSenders().find(u=>u.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(f=>o.indexOf(f)===-1);this._shimmedLocalStreams[a.id]=[a].concat(p)};const e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],e.apply(this,arguments)};const n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const p=this._shimmedLocalStreams[o].indexOf(a);p!==-1&&this._shimmedLocalStreams[o].splice(p,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),n.apply(this,arguments)}}function G(t,s){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&s.version>=65)return N(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(u=>this._reverseStreams[u.id])};const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(u=>{if(this.getSenders().find(l=>l.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const u=new t.MediaStream(c.getTracks());this._streams[c.id]=u,this._reverseStreams[u.id]=c,c=u}e.apply(this,[c])};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(d=>d===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[u.id];if(h)h.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const d=new t.MediaStream([c]);this._streams[u.id]=d,this._reverseStreams[d.id]=u,this.addStream(d)}return this.getSenders().find(d=>d.track===c)};function i(f,c){let u=c.sdp;return Object.keys(f._reverseStreams||[]).forEach(m=>{const l=f._reverseStreams[m],h=f._streams[l.id];u=u.replace(new RegExp(h.id,"g"),l.id)}),new RTCSessionDescription({type:c.type,sdp:u})}function a(f,c){let u=c.sdp;return Object.keys(f._reverseStreams||[]).forEach(m=>{const l=f._reverseStreams[m],h=f._streams[l.id];u=u.replace(new RegExp(l.id,"g"),h.id)}),new RTCSessionDescription({type:c.type,sdp:u})}["createOffer","createAnswer"].forEach(function(f){const c=t.RTCPeerConnection.prototype[f],u={[f](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[h=>{const d=i(this,h);m[0].apply(null,[d])},h=>{m[1]&&m[1].apply(null,h)},arguments[2]]):c.apply(this,arguments).then(h=>i(this,h))}};t.RTCPeerConnection.prototype[f]=u[f]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const f=p.get.apply(this);return f.type===""?f:i(this,f)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(d=>c.track===d)&&(m=this._streams[l])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function v(t,s){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const e=t.RTCPeerConnection.prototype[r],n={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=n[r]})}function U(t,s){g(t,"negotiationneeded",r=>{const e=r.target;if(!((s.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return r})}const I=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:U,shimAddTrackRemoveTrack:G,shimAddTrackRemoveTrackWithNative:N,shimGetSendersWithDtmf:A,shimGetUserMedia:L,shimMediaStream:j,shimOnTrack:F,shimPeerConnection:v,shimSenderReceiverGetStats:z},Symbol.toStringTag,{value:"Module"}));function le(t,s){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:s}:e.video.mediaSource=s,t.navigator.mediaDevices.getUserMedia(e)})}function V(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function k(t,s){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=a[n]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,a,o]=arguments;return e.apply(this,[i||null]).then(p=>{if(s.version<53&&!a)try{p.forEach(f=>{f.type=r[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;p.forEach((c,u)=>{p.set(u,Object.assign({},c,{type:r[c.type]||c.type}))})}return p}).then(a,o)}}function B(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=s.apply(this,[]);return n.forEach(i=>i._pc=this),n});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function J(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const e=s.apply(this,[]);return e.forEach(n=>n._pc=this),e}),g(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){Z("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&r.getTracks().includes(e.track)&&this.removeTrack(e)})})}function W(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function K(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.addTransceiver;s&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=s.apply(this,arguments);if(n){const{sender:a}=i,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=e,a.sendEncodings=e,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function H(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const s=t.RTCRtpSender.prototype.getParameters;s&&(t.RTCRtpSender.prototype.getParameters=function(){const e=s.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function X(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}function Y(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}const O=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:K,shimCreateAnswer:Y,shimCreateOffer:X,shimGetDisplayMedia:le,shimGetParameters:H,shimGetUserMedia:D,shimOnTrack:V,shimPeerConnection:k,shimRTCDataChannel:W,shimReceiverGetStats:J,shimRemoveStream:$,shimSenderGetStats:B},Symbol.toStringTag,{value:"Module"}));function he(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var q={exports:{}};(function(t){const s={};s.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},s.localCName=s.generateIdentifier(),s.splitLines=function(r){return r.trim().split(`
`).map(e=>e.trim())},s.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},s.getDescription=function(r){const e=s.splitSections(r);return e&&e[0]},s.getMediaSections=function(r){const e=s.splitSections(r);return e.shift(),e},s.matchPrefix=function(r,e){return s.splitLines(r).filter(n=>n.indexOf(e)===0)},s.parseCandidate=function(r){let e;r.indexOf("a=candidate:")===0?e=r.substring(12).split(" "):e=r.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let i=8;i<e.length;i+=2)switch(e[i]){case"raddr":n.relatedAddress=e[i+1];break;case"rport":n.relatedPort=parseInt(e[i+1],10);break;case"tcptype":n.tcpType=e[i+1];break;case"ufrag":n.ufrag=e[i+1],n.usernameFragment=e[i+1];break;default:n[e[i]]===void 0&&(n[e[i]]=e[i+1]);break}return n},s.writeCandidate=function(r){const e=[];e.push(r.foundation);const n=r.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(r.protocol.toUpperCase()),e.push(r.priority),e.push(r.address||r.ip),e.push(r.port);const i=r.type;return e.push("typ"),e.push(i),i!=="host"&&r.relatedAddress&&r.relatedPort&&(e.push("raddr"),e.push(r.relatedAddress),e.push("rport"),e.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(e.push("ufrag"),e.push(r.usernameFragment||r.ufrag)),"candidate:"+e.join(" ")},s.parseIceOptions=function(r){return r.substring(14).split(" ")},s.parseRtpMap=function(r){let e=r.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},s.writeRtpMap=function(r){let e=r.payloadType;r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType);const n=r.channels||r.numChannels||1;return"a=rtpmap:"+e+" "+r.name+"/"+r.clockRate+(n!==1?"/"+n:"")+`\r
`},s.parseExtmap=function(r){const e=r.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},s.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},s.parseFmtp=function(r){const e={};let n;const i=r.substring(r.indexOf(" ")+1).split(";");for(let a=0;a<i.length;a++)n=i[a].trim().split("="),e[n[0].trim()]=n[1];return e},s.writeFmtp=function(r){let e="",n=r.payloadType;if(r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const i=[];Object.keys(r.parameters).forEach(a=>{r.parameters[a]!==void 0?i.push(a+"="+r.parameters[a]):i.push(a)}),e+="a=fmtp:"+n+" "+i.join(";")+`\r
`}return e},s.parseRtcpFb=function(r){const e=r.substring(r.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},s.writeRtcpFb=function(r){let e="",n=r.payloadType;return r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(i=>{e+="a=rtcp-fb:"+n+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),e},s.parseSsrcMedia=function(r){const e=r.indexOf(" "),n={ssrc:parseInt(r.substring(7,e),10)},i=r.indexOf(":",e);return i>-1?(n.attribute=r.substring(e+1,i),n.value=r.substring(i+1)):n.attribute=r.substring(e+1),n},s.parseSsrcGroup=function(r){const e=r.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(n=>parseInt(n,10))}},s.getMid=function(r){const e=s.matchPrefix(r,"a=mid:")[0];if(e)return e.substring(6)},s.parseFingerprint=function(r){const e=r.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},s.getDtlsParameters=function(r,e){return{role:"auto",fingerprints:s.matchPrefix(r+e,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(r,e){let n="a=setup:"+e+`\r
`;return r.fingerprints.forEach(i=>{n+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),n},s.parseCryptoLine=function(r){const e=r.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},s.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?s.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const e=r.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},s.getCryptoParameters=function(r,e){return s.matchPrefix(r+e,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(r,e){const n=s.matchPrefix(r+e,"a=ice-ufrag:")[0],i=s.matchPrefix(r+e,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},s.writeIceParameters=function(r){let e="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(e+=`a=ice-lite\r
`),e},s.parseRtpParameters=function(r){const e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=s.splitLines(r)[0].split(" ");e.profile=i[2];for(let o=3;o<i.length;o++){const p=i[o],f=s.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(f){const c=s.parseRtpMap(f),u=s.matchPrefix(r,"a=fmtp:"+p+" ");switch(c.parameters=u.length?s.parseFmtp(u[0]):{},c.rtcpFeedback=s.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(s.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break}}}s.matchPrefix(r,"a=extmap:").forEach(o=>{e.headerExtensions.push(s.parseExtmap(o))});const a=s.matchPrefix(r,"a=rtcp-fb:* ").map(s.parseRtcpFb);return e.codecs.forEach(o=>{a.forEach(p=>{o.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||o.rtcpFeedback.push(p)})}),e},s.writeRtpDescription=function(r,e){let n="";n+="m="+r+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(a=>{n+=s.writeRtpMap(a),n+=s.writeFmtp(a),n+=s.writeRtcpFb(a)});let i=0;return e.codecs.forEach(a=>{a.maxptime>i&&(i=a.maxptime)}),i>0&&(n+="a=maxptime:"+i+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(a=>{n+=s.writeExtmap(a)}),n},s.parseRtpEncodingParameters=function(r){const e=[],n=s.parseRtpParameters(r),i=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,o=s.matchPrefix(r,"a=ssrc:").map(m=>s.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),p=o.length>0&&o[0].ssrc;let f;const c=s.matchPrefix(r,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(h=>parseInt(h,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(f=c[0][1]),n.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let l={ssrc:p,codecPayloadType:parseInt(m.parameters.apt,10)};p&&f&&(l.rtx={ssrc:f}),e.push(l),i&&(l=JSON.parse(JSON.stringify(l)),l.fec={ssrc:p,mechanism:a?"red+ulpfec":"red"},e.push(l))}}),e.length===0&&p&&e.push({ssrc:p});let u=s.matchPrefix(r,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substring(5),10)*1e3*.95-50*40*8:u=void 0,e.forEach(m=>{m.maxBitrate=u})),e},s.parseRtcpParameters=function(r){const e={},n=s.matchPrefix(r,"a=ssrc:").map(o=>s.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);const i=s.matchPrefix(r,"a=rtcp-rsize");e.reducedSize=i.length>0,e.compound=i.length===0;const a=s.matchPrefix(r,"a=rtcp-mux");return e.mux=a.length>0,e},s.writeRtcpParameters=function(r){let e="";return r.reducedSize&&(e+=`a=rtcp-rsize\r
`),r.mux&&(e+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(e+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),e},s.parseMsid=function(r){let e;const n=s.matchPrefix(r,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};const i=s.matchPrefix(r,"a=ssrc:").map(a=>s.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(i.length>0)return e=i[0].value.split(" "),{stream:e[0],track:e[1]}},s.parseSctpDescription=function(r){const e=s.parseMLine(r),n=s.matchPrefix(r,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const a=s.matchPrefix(r,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:e.fmt,maxMessageSize:i};const o=s.matchPrefix(r,"a=sctpmap:");if(o.length>0){const p=o[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},s.writeSctpDescription=function(r,e){let n=[];return r.protocol!=="DTLS/SCTP"?n=["m="+r.kind+" 9 "+r.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+r.kind+" 9 "+r.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,22)},s.writeSessionBoilerplate=function(r,e,n){let i;const a=e!==void 0?e:2;return r?i=r:i=s.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+i+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.getDirection=function(r,e){const n=s.splitLines(r);for(let i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substring(2)}return e?s.getDirection(e):"sendrecv"},s.getKind=function(r){return s.splitLines(r)[0].split(" ")[0].substring(2)},s.isRejected=function(r){return r.split(" ",2)[1]==="0"},s.parseMLine=function(r){const n=s.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},s.parseOLine=function(r){const n=s.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},s.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const e=s.splitLines(r);for(let n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},t.exports=s})(q);var Q=q.exports;const C=he(Q),de=me({__proto__:null,default:C},[Q]);function y(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const s=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new s(e),i=C.parseCandidate(e.candidate);for(const a in i)a in n||Object.defineProperty(n,a,{value:i[a]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new s(e)},t.RTCIceCandidate.prototype=s.prototype,g(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function b(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||g(t,"icecandidate",s=>{if(s.candidate){const r=C.parseCandidate(s.candidate.candidate);r.type==="relay"&&(s.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return s})}function T(t,s){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(o){if(!o||!o.sdp)return!1;const p=C.splitSections(o.sdp);return p.shift(),p.some(f=>{const c=C.parseMLine(f);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},e=function(o){const p=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const f=parseInt(p[1],10);return f!==f?-1:f},n=function(o){let p=65536;return s.browser==="firefox"&&(s.version<57?o===-1?p=16384:p=2147483637:s.version<60?p=s.version===57?65535:65536:p=2147483637),p},i=function(o,p){let f=65536;s.browser==="firefox"&&s.version===57&&(f=65535);const c=C.matchPrefix(o.sdp,"a=max-message-size:");return c.length>0?f=parseInt(c[0].substring(19),10):s.browser==="firefox"&&p!==-1&&(f=2147483637),f},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,s.browser==="chrome"&&s.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=e(arguments[0]),f=n(p),c=i(arguments[0],p);let u;f===0&&c===0?u=Number.POSITIVE_INFINITY:f===0||c===0?u=Math.max(f,c):u=Math.min(f,c);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return u}}),this._sctp=m}return a.apply(this,arguments)}}function S(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function s(e,n){const i=e.send;e.send=function(){const o=arguments[0],p=o.length||o.size||o.byteLength;if(e.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return s(n,this),n},g(t,"datachannel",e=>(s(e.channel,e.target),e))}function _(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype;Object.defineProperty(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const e=s[r];s[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const i=n.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const a=new Event("connectionstatechange",n);i.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}function x(t,s){if(!t.RTCPeerConnection||s.browser==="chrome"&&s.version>=71||s.browser==="safari"&&s._safariVersion>=13.1)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function R(t,s){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(s.browser==="chrome"&&s.version<78||s.browser==="firefox"&&s.version<68||s.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function P(t,s){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>r.apply(this,[a]))})}const ge=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:x,shimAddIceCandidateNullOrEmpty:R,shimConnectionState:_,shimMaxMessageSize:T,shimParameterlessSetLocalDescription:P,shimRTCIceCandidate:y,shimRTCIceCandidateRelayProtocol:b,shimSendThrowTypeError:S},Symbol.toStringTag,{value:"Module"}));function Ce({window:t}={},s={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=ne,e=w(t),n={browserDetails:e,commonShim:ge,extractVersion:re,disableLog:te,disableWarnings:ee,sdp:de};switch(e.browser){case"chrome":if(!I||!v||!s.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(e.version===null)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=I,R(t,e),P(t),L(t,e),j(t),v(t,e),F(t),G(t,e),A(t),z(t),U(t,e),y(t),b(t),_(t),T(t,e),S(t),x(t,e);break;case"firefox":if(!O||!k||!s.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=O,R(t,e),P(t),D(t,e),k(t,e),V(t),$(t),B(t),J(t),W(t),K(t),H(t),X(t),Y(t),y(t),_(t),T(t,e),S(t);break;case"safari":if(!M||!s.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=M,R(t,e),P(t),se(t),ie(t),ae(t),oe(t),ce(t),pe(t),fe(t),ue(t),y(t),b(t),T(t,e),S(t),x(t,e);break;default:r("Unsupported browser!");break}return n}const Pe=Ce({window:typeof window>"u"?void 0:window});export{Pe as default};
